<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#000000">
    <meta name="description" content="Car service management application">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Carigar">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/icon-152x152.png">
    <title>Carigar</title>
    <script>
        // Initialize dark mode before any rendering
        if (localStorage.getItem('theme') === 'light') {
            document.documentElement.classList.remove('dark');
        } else {
            document.documentElement.classList.add('dark');
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/look.css">
    <link rel="stylesheet" href="../assets/css/dark-mode.css">
    <script src="../assets/js/dark-mode-init.js"></script>
    <script src="../assets/js/supabase-db.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>

    <script src="../assets/js/supabase.js"></script>
    <script src="../assets/js/auth-middleware.js"></script>
    <script src="../assets/js/notifications.js"></script>
    <script src="../assets/js/utils.js" type="module"></script>
    <script src="../assets/js/estimate.js" type="module"></script>
</head>
<body class="flex min-h-screen flex-col">
    <!-- Main Content -->
    <div class="flex-1 flex flex-col">
        <!-- Top Navbar -->
        <div class="top-nav h-16 shadow-md flex items-center px-4 md:px-6 sticky top-0 z-10 relative justify-between md:justify-start hidden md:flex">
            <div class="flex items-center gap-2">
                <span class="text-2xl font-semibold gilroy text-black dark:text-white hidden dark:block">Carigar</span>
            </div>
            <div class="flex gap-6 items-center ml-10">
                <a href="index.html" class="nav-icon-btn" title="Home">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7m-9 2v10a1 1 0 001 1h4a1 1 0 001-1V12m-4-2h4" />
                    </svg>
                </a>
                <a href="order.html" class="nav-icon-btn active" title="Order">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                </a>
                <a href="inventory.html" class="nav-icon-btn" title="Inventory">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 13H5v6a2 2 0 002 2h10a2 2 0 002-2v-6m-7-2V3m0 0L9 7m3-4l3 4" />
                    </svg>
                </a>
                <a href="carprofile.html" class="nav-icon-btn" title="Car Profile">
                    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                    </svg>
                </a>
            </div>
            <div class="ml-auto flex gap-2 items-center">
                <button id="theme-toggle" class="p-2 rounded-lg bg-light-toggle dark:bg-dark-toggle text-light-text dark:text-dark-text hover:bg-light-toggle-hover dark:hover:bg-dark-toggle-hover">
                    <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                </button>
            </div>
            <!-- Dropdown Menu (Mobile Only) -->
            <div id="hamburger-menu" class="hidden md:hidden absolute top-16 left-0 w-full bg-white dark:bg-dark-panel shadow-lg z-20">
                <div class="flex flex-col items-start p-4 gap-4">
                    <a href="index.html" class="text-light-text dark:text-dark-text gilroy font-medium text-base hover:text-blue-500">Home</a>
                    <a href="order.html" class="text-light-text dark:text-dark-text gilroy font-medium text-base hover:text-blue-500">Order</a>
                    <a href="inventory.html" class="text-light-text dark:text-dark-text gilroy font-medium text-base hover:text-blue-500">Inventory</a>
                    <a href="carprofile.html" class="text-light-text dark:text-dark-text gilroy font-medium text-base hover:text-blue-500">Car Profile</a>
                </div>
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-container flex-1 flex flex-col md:flex-row px-4 md:px-6 pb-6 gap-6">
            <!-- Order Form Section -->
            <div class="w-full md:w-2/3 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white">Create Order</h2>
                
                <!-- Customer Details Section -->
                <div class="mb-6">
                    <div class="space-y-4">
                        <div>
                            <label for="customer-name" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-200">Customer Name</label>
                            <div class="relative">
                                <input id="customer-name" type="text" placeholder="Enter customer name" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-white" onkeyup="findCustomer()">
                                <div id="customer-suggestions" class="absolute w-full border rounded-lg mt-1 max-h-40 overflow-y-auto bg-white dark:bg-gray-700 text-gray-900 dark:text-white hidden z-10"></div>
                            </div>
                        </div>
                        <div>
                            <label for="vehicle-number" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-200">Vehicle Number</label>
                            <input id="vehicle-number" type="text" placeholder="Enter vehicle number" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-white">
                        </div>
                    </div>
                    <div id="customer-options" class="hidden mt-4 p-4 border border-gray-200 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700"></div>
                </div>

                <!-- Job Title Input -->
                <div id="job-title-container" class="mb-6 hidden">
                    <label for="job-title" class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-200">Job Title</label>
                    <input id="job-title" type="text" placeholder="Enter job title" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-white" onblur="createJobSection()">
                </div>
                
                <!-- Job Sections -->
                <div id="job-sections" class="space-y-6 mb-6"></div>
                
                <!-- Other Section -->
                <div id="other-section" class="mb-6 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-900 dark:text-white cursor-pointer editable-title" onclick="setCurrentJobSection(this.parentElement.parentElement)" contenteditable="true">Other</h3>
                    </div>
                    <div id="other-parts-list" class="space-y-4 mb-4">
                        <!-- Part items will be added here -->
                    </div>
                    <div id="other-labor-list" class="space-y-4 mb-4">
                        <!-- Labor items will be added here -->
                    </div>
                    <div class="flex flex-wrap gap-4 mb-4">
                        <button onclick="addPart()" class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors">Add Part</button>
                        <button onclick="addLabor()" class="px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors">Add Labor</button>
                    </div>
                    <div class="flex flex-col md:flex-row justify-between text-gray-600 dark:text-gray-300">
                        <div class="space-x-4">
                            <span>Parts: ₹<span id="other-parts-total">0</span></span>
                            <span>Labor: ₹<span id="other-labor-total">0</span></span>
                            <span>Total: ₹<span id="other-total">0</span></span>
                        </div>
                    </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex flex-wrap gap-4 mb-6">
                    <button onclick="showJobTitleInput()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">Add Job</button>
                </div>
                
                <!-- Grand Total -->
                <div class="flex flex-col md:flex-row justify-between mb-6 text-gray-700 dark:text-gray-200 font-medium">
                    <div class="space-x-4">
                        <span>Parts: ₹<span id="grand-parts-total">0</span></span>
                        <span>Labor: ₹<span id="grand-labor-total">0</span></span>
                        <span>Total: ₹<span id="grand-total">0</span></span>
                    </div>
                </div>
                
                <!-- Export/Save Buttons -->
                <div class="flex flex-wrap gap-4">
                    <button onclick="generatePDF()" class="px-6 py-3 bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium rounded-lg transition-colors">Export to PDF</button>
                    <button onclick="saveEstimate()" class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors">Save Estimate</button>
                    <button onclick="saveReceipt()" class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors">Save Receipt</button>
                </div>
            </div>

            <!-- Recent Orders Section -->
            <div class="w-full md:w-1/3 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-xl font-bold mb-6 text-gray-900 dark:text-white">Recent Orders</h2>
                <div id="recent-orders" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation (Mobile Only) -->
    <div class="bottom-nav fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-dark-panel shadow-md flex items-center justify-around md:hidden z-20">
        <div class="flex justify-around items-center w-full max-w-md mx-auto py-2">
            <a href="index.html" class="bottom-nav-icon-btn" title="Home">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7m-9 2v10a1 1 0 001 1h4a1 1 0 001-1V12m-4-2h4" />
                </svg>
            </a>
            <a href="order.html" class="bottom-nav-icon-btn active" title="Order">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
            </a>
            <a href="inventory.html" class="bottom-nav-icon-btn" title="Inventory">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 13H5v6a2 2 0 002 2h10a2 2 0 002-2v-6m-7-2V3m0 0L9 7m3-4l3 4" />
                </svg>
            </a>
            <a href="carprofile.html" class="bottom-nav-icon-btn" title="Car Profile">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                </svg>
            </a>
        </div>
    </div>

    <script>
        // Hamburger menu toggle
        document.getElementById('hamburger-toggle')?.addEventListener('click', () => {
            const menu = document.getElementById('hamburger-menu');
            menu.classList.toggle('hidden');
        });
        
        // Theme toggle
        document.getElementById('theme-toggle')?.addEventListener('click', () => {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        });
        
        // Set initial theme
        if (localStorage.getItem('theme') === 'dark' || 
            (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }
    </script>

    <style>
        /* Update existing styles */
        .main-container {
            padding-bottom: 5rem;
        }

        .nav-btn {
            @apply flex flex-col items-center justify-center gap-1 p-2 rounded-lg transition-colors duration-200;
        }

        .nav-btn.active {
            @apply bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white;
        }

        .nav-icon {
            @apply w-6 h-6;
        }

        .nav-text {
            @apply text-xs;
        }

        /* Input and Select Styles */
        input[type="text"],
        input[type="number"],
        select,
        textarea {
            @apply w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-white;
        }

        /* Part and Labor Item Styles */
        .part-item,
        .labor-item {
            @apply p-4 bg-gray-50 dark:bg-gray-700 rounded-lg border border-gray-200 dark:border-gray-600 flex items-center gap-4;
        }

        .part-item input,
        .labor-item input {
            @apply flex-1 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-gray-900 dark:text-white;
        }

        .part-item button,
        .labor-item button {
            @apply p-2 text-red-500 hover:text-red-600 rounded-lg transition-colors;
        }

        /* Mobile specific styles */
        @media (max-width: 768px) {
            .main-container {
                padding-bottom: 6rem;
            }
            
            .top-nav {
                display: none;
            }
            
            .bottom-nav {
                display: flex;
            }
        }

        /* Desktop specific styles */
        @media (min-width: 769px) {
            .top-nav {
                display: flex;
            }
            
            .bottom-nav {
                display: none;
            }
        }
    </style>
</body>
</html>